# Dockerfile para DESENVOLVIMENTO
# POR QUÊ: Mantém hot-reload e desenvolvimento rápido
# Use este para desenvolvimento local

FROM node:20-alpine

WORKDIR /app

# Instala dependências do sistema
RUN apk add --no-cache libc6-compat git

# Copia arquivos de dependências
COPY package.json package-lock.json* ./

# Instala dependências do projeto
RUN npm ci --legacy-peer-deps || npm install

# Copia todo o código fonte
COPY . .

# Gera o Prisma Client
RUN npx prisma generate

# Expõe a porta 3000
EXPOSE 3000

# POR QUÊ: Usa o servidor customizado que suporta WebSocket
# O servidor customizado roda tanto o Next.js quanto o Socket.IO
CMD ["sh", "-c", "npx prisma db push && npm run dev:custom"]

